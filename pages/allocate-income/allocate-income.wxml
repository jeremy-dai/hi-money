<!--pages/allocate-income/allocate-income.wxml-->
<view class="container">
  <view class="header">
    <view class="title">æ™ºèƒ½åˆ†é…æ”¶å…¥</view>
    <view class="subtitle">åˆ†æå½“å‰æ¯”ä¾‹ï¼Œæä¾›æœ€ä¼˜åˆ†é…æ–¹æ¡ˆ</view>
  </view>

  <!-- å½“å‰çŠ¶æ€åˆ†æ -->
  <view class="status-card">
    <view class="card-title">å½“å‰èµ„äº§çŠ¶å†µ</view>
    <view class="total-assets">
      <text class="label">æ€»èµ„äº§</text>
      <text class="amount">Â¥{{currentStatus.totalAssets.toFixed(2)}}</text>
    </view>

    <view class="status-grid">
      <view class="status-item">
        <view class="status-name">ğŸ“ˆ å¢é•¿æŠ•èµ„</view>
        <view class="status-value">
          <text class="current-percentage">{{currentStatus.growth.percentage.toFixed(1)}}%</text>
          <text class="target-percentage">ç›®æ ‡25%</text>
        </view>
        <view class="deviation {{currentStatus.growth.deviation < 0 ? 'deficit' : 'surplus'}}">
          {{currentStatus.growth.deviation > 0 ? '+' : ''}}{{currentStatus.growth.deviation.toFixed(1)}}%
        </view>
      </view>

      <view class="status-item">
        <view class="status-name">ğŸ›¡ï¸ ç¨³å®šåŸºé‡‘</view>
        <view class="status-value">
          <text class="current-percentage">{{currentStatus.stability.percentage.toFixed(1)}}%</text>
          <text class="target-percentage">ç›®æ ‡15%</text>
        </view>
        <view class="deviation {{currentStatus.stability.deviation < 0 ? 'deficit' : 'surplus'}}">
          {{currentStatus.stability.deviation > 0 ? '+' : ''}}{{currentStatus.stability.deviation.toFixed(1)}}%
        </view>
      </view>

      <view class="status-item">
        <view class="status-name">ğŸ  åŸºæœ¬å¼€æ”¯</view>
        <view class="status-value">
          <text class="current-percentage">{{currentStatus.essentials.percentage.toFixed(1)}}%</text>
          <text class="target-percentage">ç›®æ ‡50%</text>
        </view>
        <view class="deviation {{currentStatus.essentials.deviation < 0 ? 'deficit' : 'surplus'}}">
          {{currentStatus.essentials.deviation > 0 ? '+' : ''}}{{currentStatus.essentials.deviation.toFixed(1)}}%
        </view>
      </view>

      <view class="status-item">
        <view class="status-name">ğŸ å¥–åŠ±æ¶ˆè´¹</view>
        <view class="status-value">
          <text class="current-percentage">{{currentStatus.rewards.percentage.toFixed(1)}}%</text>
          <text class="target-percentage">ç›®æ ‡10%</text>
        </view>
        <view class="deviation {{currentStatus.rewards.deviation < 0 ? 'deficit' : 'surplus'}}">
          {{currentStatus.rewards.deviation > 0 ? '+' : ''}}{{currentStatus.rewards.deviation.toFixed(1)}}%
        </view>
      </view>
    </view>

    <view class="tip">
      <text class="tip-icon">ğŸ’¡</text>
      <text class="tip-text">çº¢è‰²è¡¨ç¤ºä¸è¶³ï¼Œç»¿è‰²è¡¨ç¤ºè¶…æ ‡</text>
    </view>
  </view>

  <!-- è¾“å…¥æ–°æ”¶å…¥ -->
  <view class="input-card">
    <view class="input-label">æœ¬æ¬¡æ”¶å…¥é‡‘é¢</view>
    <input
      class="income-input"
      type="digit"
      value="{{incomeAmount}}"
      placeholder="è¾“å…¥é‡‘é¢"
      bindinput="onIncomeInput"
    />
  </view>

  <!-- åˆ†é…æ–¹æ¡ˆ -->
  <view class="plans-section" wx:if="{{planA && planB}}">
    <view class="plans-title">é€‰æ‹©åˆ†é…æ–¹æ¡ˆ</view>

    <!-- æ–¹æ¡ˆA -->
    <view class="plan-card {{selectedPlan === 'A' ? 'selected' : ''}}" bindtap="selectPlan" data-plan="A">
      <view class="plan-header">
        <view class="plan-name">
          <text class="plan-icon">ğŸ“Š</text>
          <text>æ–¹æ¡ˆAï¼šå›ºå®šæ¯”ä¾‹</text>
        </view>
        <view class="plan-tag">ç¨³å®š</view>
      </view>
      <view class="plan-description">æŒ‰ç…§ 25-15-50-10 æ ‡å‡†æ¯”ä¾‹åˆ†é…</view>
      <view class="plan-details">
        <view class="plan-item">
          <text class="plan-category">å¢é•¿æŠ•èµ„</text>
          <text class="plan-amount">Â¥{{planA.growth.toFixed(2)}}</text>
        </view>
        <view class="plan-item">
          <text class="plan-category">ç¨³å®šåŸºé‡‘</text>
          <text class="plan-amount">Â¥{{planA.stability.toFixed(2)}}</text>
        </view>
        <view class="plan-item">
          <text class="plan-category">åŸºæœ¬å¼€æ”¯</text>
          <text class="plan-amount">Â¥{{planA.essentials.toFixed(2)}}</text>
        </view>
        <view class="plan-item">
          <text class="plan-category">å¥–åŠ±æ¶ˆè´¹</text>
          <text class="plan-amount">Â¥{{planA.rewards.toFixed(2)}}</text>
        </view>
      </view>
    </view>

    <!-- æ–¹æ¡ˆB -->
    <view class="plan-card {{selectedPlan === 'B' ? 'selected' : ''}}" bindtap="selectPlan" data-plan="B">
      <view class="plan-header">
        <view class="plan-name">
          <text class="plan-icon">ğŸ¯</text>
          <text>æ–¹æ¡ˆBï¼šæ™ºèƒ½å¹³è¡¡</text>
        </view>
        <view class="plan-tag smart">æ¨è</view>
      </view>
      <view class="plan-description">ä¼˜å…ˆè¡¥é½ä¸è¶³çš„ç±»åˆ«ï¼Œå¿«é€Ÿè¾¾åˆ°ç›®æ ‡æ¯”ä¾‹</view>
      <view class="plan-details">
        <view class="plan-item">
          <text class="plan-category">å¢é•¿æŠ•èµ„</text>
          <text class="plan-amount">Â¥{{planB.growth.toFixed(2)}}</text>
        </view>
        <view class="plan-item">
          <text class="plan-category">ç¨³å®šåŸºé‡‘</text>
          <text class="plan-amount">Â¥{{planB.stability.toFixed(2)}}</text>
        </view>
        <view class="plan-item">
          <text class="plan-category">åŸºæœ¬å¼€æ”¯</text>
          <text class="plan-amount">Â¥{{planB.essentials.toFixed(2)}}</text>
        </view>
        <view class="plan-item">
          <text class="plan-category">å¥–åŠ±æ¶ˆè´¹</text>
          <text class="plan-amount">Â¥{{planB.rewards.toFixed(2)}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç¡®è®¤æŒ‰é’® -->
  <view class="button-wrapper" wx:if="{{planA && planB}}">
    <button class="confirm-button" bindtap="confirmAllocation">ç¡®è®¤åˆ†é…</button>
  </view>
</view>
