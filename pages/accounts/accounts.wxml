<!--pages/accounts/accounts.wxml-->
<view class="container">
  <view class="header">
    <view class="title">管理账户</view>
    <view class="subtitle">录入各类别现有金额</view>
  </view>

  <!-- 总资产概览 -->
  <view class="summary-card">
    <view class="summary-row">
      <text class="summary-label">当前总资产</text>
      <text class="summary-amount">¥ {{totalAssets.toFixed(2)}}</text>
    </view>
    <view class="summary-row">
      <text class="summary-label">目标金额</text>
      <text class="summary-goal">¥ {{goalAmount.toFixed(2)}}</text>
    </view>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{totalAssets / goalAmount * 100}}%"></view>
    </view>
    <view class="progress-text">完成 {{(totalAssets / goalAmount * 100).toFixed(1)}}%</view>
  </view>

  <!-- 各类别账户 -->
  <view class="categories-section">
    <block wx:for="{{categories}}" wx:key="key">
      <view class="category-section">
        <view class="category-header" style="border-left-color: {{item.color}}">
          <text class="category-icon">{{item.icon}}</text>
          <view class="category-info">
            <text class="category-name">{{item.name}}</text>
            <text class="category-target">目标: ¥{{(goalAmount * item.percentage / 100).toFixed(2)}}</text>
          </view>
          <view class="category-total">
            <text class="total-amount">¥{{categoryTotals[item.key].toFixed(2)}}</text>
            <text class="total-percentage">{{item.percentage}}%</text>
          </view>
        </view>

        <!-- 账户列表 -->
        <view class="accounts-list">
          <block wx:for="{{accounts[item.key]}}" wx:for-item="account" wx:for-index="idx" wx:key="idx">
            <view class="account-item">
              <view class="account-name">{{account.name}}</view>
              <view class="account-actions">
                <text class="account-amount" bindtap="updateAccountAmount" data-category="{{item.key}}" data-index="{{idx}}">
                  ¥{{account.amount.toFixed(2)}}
                </text>
                <text class="delete-btn" bindtap="deleteAccount" data-category="{{item.key}}" data-index="{{idx}}">删除</text>
              </view>
            </view>
          </block>

          <!-- 添加账户按钮 -->
          <view class="add-account-btn" bindtap="addAccount" data-category="{{item.key}}">
            <text class="add-icon">+</text>
            <text>添加{{item.name}}账户</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- 完成按钮 -->
  <view class="button-wrapper">
    <button class="complete-button" bindtap="completeSetup">完成设置</button>
  </view>
</view>
